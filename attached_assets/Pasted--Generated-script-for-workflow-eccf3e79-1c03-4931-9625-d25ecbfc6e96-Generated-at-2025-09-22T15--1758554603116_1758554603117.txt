// Generated script for workflow eccf3e79-1c03-4931-9625-d25ecbfc6e96
// Generated at 2025-09-22T15:20:43.438Z

import { Stagehand, type ConstructorParams } from '@browserbasehq/stagehand';
import { z } from 'zod';

// Stagehand configuration
const stagehandConfig = (): ConstructorParams => {
  return {
    env: 'BROWSERBASE',
    verbose: 1,
    modelName: 'google/gemini-2.5-flash-preview-05-20',
    disablePino: true,
    modelClientOptions: {
      apiKey: process.env.GOOGLE_API_KEY,
    },
  };
};

async function runWorkflow() {
  let stagehand: Stagehand | null = null;

  try {
    // Initialize Stagehand
    console.log('Initializing Stagehand...');
    stagehand = new Stagehand(stagehandConfig());
    await stagehand.init();
    console.log('Stagehand initialized successfully.');

    // Get the page instance
    const page = stagehand.page;
    if (!page) {
      throw new Error('Failed to get page instance from Stagehand');
    }

    // Step 1: Navigate to URL
    console.log(
      'Navigating to: https://www.phlcontracts.phila.gov/bso/external/bidDetail.sdo?docId=B2624978',
    );
    await page.goto(
      'https://www.phlcontracts.phila.gov/bso/external/bidDetail.sdo?docId=B2624978',
    );

    // Step 2: Extract data
    console.log(
      `Extracting: Extract all the key details of this RFP including bid information, contact details, items, and requirements`,
    );
    const extractedData2 = await page.extract({
      instruction: `Extract all the key details of this RFP including bid information, contact details, items, and requirements`,
      schema: z.object({
        bidNumber: z.string().optional(),
        description: z.string().optional(),
        bidOpeningDate: z.string().optional(),
        purchaser: z.string().optional(),
        organization: z.string().optional(),
        department: z.string().optional(),
        location: z.string().optional(),
        fiscalYear: z.string().optional(),
        typeCode: z.string().optional(),
        allowElectronicQuote: z.string().optional(),
        requiredDate: z.string().optional(),
        availableDate: z.string().optional(),
        infoContact: z.string().optional(),
        bidType: z.string().optional(),
        purchaseMethod: z.string().optional(),
        bulletinDescription: z.string().optional(),
        shipToAddress: z
          .object({
            name: z.string().optional(),
            address: z.string().optional(),
            email: z.string().optional(),
            phone: z.string().optional(),
          })
          .optional(),
        items: z
          .array(
            z.object({
              itemNumber: z.string().optional(),
              description: z.string().optional(),
              nigpCode: z.string().optional(),
              quantity: z.string().optional(),
              unitOfMeasure: z.string().optional(),
            }),
          )
          .optional(),
        attachments: z.array(z.string()).optional(),
      }),
    });
    console.log('Extracted:', extractedData2);

    // Step 3: Perform action
    console.log(
      `Performing action: click the "B2624978 Seller Checklist Form.pdf" link`,
    );
    await page.act(`click the "B2624978 Seller Checklist Form.pdf" link`);

    // Step 4: Navigate back
    console.log('Navigating back to previous page');
    await page.goBack();
    await page.waitForTimeout(5000);

    // Step 5: Navigate back
    console.log('Navigating back to previous page');
    await page.goBack();
    await page.waitForTimeout(5000);

    // Step 6: Navigate back
    console.log('Navigating back to previous page');
    await page.goBack();
    await page.waitForTimeout(5000);

    // Step 7: Navigate back
    console.log('Navigating back to previous page');
    await page.goBack();
    await page.waitForTimeout(5000);

    // Step 8: Navigate back
    console.log('Navigating back to previous page');
    await page.goBack();
    await page.waitForTimeout(5000);

    // Step 9: Navigate back
    console.log('Navigating back to previous page');
    await page.goBack();
    await page.waitForTimeout(5000);

    // Step 10: Navigate back
    console.log('Navigating back to previous page');
    await page.goBack();
    await page.waitForTimeout(5000);

    // Step 11: Navigate back
    console.log('Navigating back to previous page');
    await page.goBack();
    await page.waitForTimeout(5000);

    // Step 12: Navigate back
    console.log('Navigating back to previous page');
    await page.goBack();
    await page.waitForTimeout(5000);

    console.log('Workflow completed successfully');
    return { success: true };
  } catch (error) {
    console.error('Workflow failed:', error);
    return { success: false, error };
  } finally {
    // Clean up
    if (stagehand) {
      console.log('Closing Stagehand connection.');
      try {
        await stagehand.close();
      } catch (err) {
        console.error('Error closing Stagehand:', err);
      }
    }
  }
}

// Single execution
runWorkflow().then((result) => {
  console.log('Execution result:', result);
  process.exit(result.success ? 0 : 1);
});

export default runWorkflow;
