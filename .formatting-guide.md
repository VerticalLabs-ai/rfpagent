# Code Formatting & Linting Guide

This project uses automated code formatting and linting to maintain consistent code style across the repository.

## Tools Configured

- **Prettier** - Code formatter for consistent style
- **ESLint** - Code linter for code quality and best practices
- **Husky + lint-staged** - Pre-commit hooks to enforce formatting

## Configuration Files

- `.prettierrc.json` - Prettier configuration (double quotes, semicolons, 100 char width)
- `.prettierignore` - Files/directories excluded from formatting
- `eslint.config.js` - ESLint flat config with TypeScript, React, and React Hooks support
- `package.json` - Contains `lint-staged` configuration for pre-commit hooks

## Available Commands

### Formatting

```bash
# Format all files
pnpm run format

# Check formatting without making changes
pnpm run format:check
```

### Linting

```bash
# Run ESLint
pnpm run lint

# Run ESLint and auto-fix issues
pnpm run lint:fix
```

### Type Checking

```bash
# Run TypeScript type checking
pnpm run type-check
```

### Quality Check (All in One)

```bash
# Run type-check, lint, format:check, and tests
pnpm run quality
```

## Pre-commit Hooks

The project uses Husky and lint-staged to automatically format and lint files before commits:

- Files are automatically formatted with Prettier
- ESLint auto-fixes are applied (skips files with `@ts-nocheck`)
- Only staged files are processed for performance

## CI/CD Integration

The GitHub Actions CI workflow (`.github/workflows/ci-cd.yml`) enforces code quality:

1. **Quality Job** runs on every PR and push:
   - Runs `pnpm run lint`
   - Runs `pnpm run format:check` (fails if files aren't formatted)
   - Runs `pnpm run type-check`

2. **Workflow ensures**:
   - All code is properly formatted before merge
   - No linting errors exist
   - TypeScript types are correct

## Code Style Rules

### Prettier (Formatting)

- **Quotes**: Double quotes (`"`)
- **Semicolons**: Required (`;`)
- **Tab Width**: 2 spaces
- **Line Width**: 100 characters
- **Trailing Commas**: ES5 compatible
- **Arrow Parens**: Always use parentheses

### ESLint (Code Quality)

- **Semi**: Required semicolons
- **Quotes**: Double quotes enforced
- **React**: React 18+ (no need for `React` in JSX scope)
- **TypeScript**: Warn on `any` types, unused vars (except prefixed with `_`)
- **No console**: Allowed (for backend logging)

## Usage in Development

### Automatic (Recommended)

Just commit your code - pre-commit hooks will automatically format and lint:

```bash
git add .
git commit -m "feat: add new feature"
# Husky runs lint-staged automatically
```

### Manual

Format and lint before committing:

```bash
pnpm run format
pnpm run lint:fix
pnpm run type-check
git add .
git commit -m "feat: add new feature"
```

### Fixing CI Failures

If CI fails due to formatting:

```bash
# Format all files
pnpm run format

# Commit the formatting changes
git add .
git commit -m "style: apply prettier formatting"
git push
```

If CI fails due to linting:

```bash
# Auto-fix linting issues
pnpm run lint:fix

# Check remaining issues manually
pnpm run lint

# Fix any remaining issues, then commit
git add .
git commit -m "fix: resolve linting issues"
git push
```

## IDE Integration

### VS Code

Install these extensions for automatic formatting on save:

- **Prettier - Code formatter** (`esbenp.prettier-vscode`)
- **ESLint** (`dbaeumer.vscode-eslint`)

Add to your `.vscode/settings.json`:

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact"
  ]
}
```

### Other IDEs

- **WebStorm/IntelliJ**: Enable Prettier and ESLint in settings
- **Vim/Neovim**: Use `vim-prettier` and `ale` or `coc-prettier`
- **Sublime Text**: Use `JsPrettier` and `SublimeLinter-eslint`

## Troubleshooting

### "Parsing error" from ESLint

Run type-check first to identify TypeScript errors:
```bash
pnpm run type-check
```

### Formatting conflicts between Prettier and ESLint

The project uses `eslint-config-prettier` to disable conflicting ESLint rules. If you see conflicts, ensure `eslint-config-prettier` is installed and properly configured.

### Pre-commit hooks not running

Reinstall Husky:
```bash
pnpm run prepare
```

### Files not being formatted

Check if the file is in `.prettierignore`. Some directories like `dist/`, `node_modules/`, and generated files are intentionally excluded.

## Best Practices

1. **Format before committing** - Even with pre-commit hooks, it's good to format early
2. **Fix linting issues as you code** - Don't accumulate technical debt
3. **Use IDE integration** - Save time with automatic formatting
4. **Run quality check before pushing** - Catch issues before CI fails
5. **Keep configurations in sync** - Don't override project configs locally

## Related Files

- `.prettierrc.json` - Prettier config
- `.prettierignore` - Prettier ignore patterns
- `eslint.config.js` - ESLint config (flat config)
- `.github/workflows/ci-cd.yml` - CI/CD workflow
- `package.json` - Scripts and lint-staged config
- `.husky/pre-commit` - Pre-commit hook script
